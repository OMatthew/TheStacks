<!DOCTYPE html>
<html>
<head>
<title>The Stacks: Leave Your Mark</title>
<link rel="shortcut icon" href="Images/theStacks.png">
<script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDUd4z57ZhhXzIDclL6vTSqHW_WY5aKDCY"></script>
<script type="text/javascript">
$(document).ready(function() {

	var mapStartCenter = new google.maps.LatLng(30.2500, -97.7500); //Google map Coordinates
	var map;
	
	function setIdle(cb, seconds) {
    var timer; 
    var interval = seconds * 1000;
    function refresh() {
            clearInterval(timer);
            timer = setTimeout(cb, interval);
    	};
    $(document).on('keypress, click', refresh);
    refresh();
	}

setIdle(function() {
    location.href = 'http://utw10077.utweb.utexas.edu/';
	}, 18000);

	function stopRKey(evt) { 
  var evt = (evt) ? evt : ((event) ? event : null); 
  var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
  if ((evt.keyCode == 13) && (node.type=="text"))  {return false;} 
} 

document.onkeypress = stopRKey; 

	map_initialize(); // initialize google map
	
	//############### Google Map Initialize ##############
	function map_initialize()
	{
			var googleMapOptions = 
			{ 
				center: mapStartCenter, // map center
				zoom: 12, //zoom level, 0 = earth view to higher value
				maxZoom: 24,
				minZoom: 0,
				panControl: false,
				//mapTypeId: google.maps.MapTypeId.SATELLITE,
				zoomControlOptions: {

				//style: google.maps.ZoomControlStyle.SMALL, //zoom control size
				position: google.maps.ControlPosition.RIGHT
			},
				scaleControl: true, // enable scale control
				mapTypeId: google.maps.MapTypeId.HYBRID // google map type
			};
		
		   	map = new google.maps.Map(document.getElementById("google_map"), googleMapOptions);			
			
			//Load Markers from the XML File, Check (map_process.php)
			$.get("map_process.php", function (data) {
				$(data).find("marker").each(function () {
					  //var markerTitle = $(this).attr('markerTitle');
					  var name 		= '<div class="saved-info saved-title">'+ $(this).attr('name')+'</div>';
					  var description 	= '<div class="saved-info saved-description">'+ $(this).attr('description') +'</div>';
					  //var type 		= $(this).attr('type');
					  var point 	= new google.maps.LatLng(parseFloat($(this).attr('lat')),parseFloat($(this).attr('lng')));
					  var winStyle = $(this).attr('winStyle');
					  var mapPinURL = $(this).attr('mapPinURL');
					  create_marker(point, name, description, false, false, false, mapPinURL, winStyle);
				});
			});	
			
			//Right Click to Drop a New Marker
			/*
			google.maps.event.addListener(map, 'rightclick', function(event) {
				//Edit form to be displayed with new marker
				var EditForm = '<p><div class="marker-edit">'+
				'<form action="ajax-save.php" method="POST" name="SaveMarker" id="SaveMarker">'+
				'<label for="pName"><span>Place Name :</span><input type="text" name="pName" class="save-name" placeholder="Enter Title" maxlength="40" /></label>'+
				'<label for="pDesc"><span>Description :</span><textarea name="pDesc" class="save-desc" placeholder="Enter Address" maxlength="150"></textarea></label>'+
				/*'<label for="pType"><span>Type :</span> <select name="pType" class="save-type"><option value="restaurant">Rastaurant</option><option value="bar">Bar</option>'+
				'<option value="house">House</option></select></label>'+
				'</form>'+
				'</div></p><button name="save-marker" class="save-marker">Save Marker Details</button>';

				//Drop a new Marker with our Edit Form
				create_marker(event.latLng, 'Your favorite place', EditForm, true, true, true, "http://maps.google.com/mapfiles/ms/micons/blue.png");
			});*/

			$(document).ready(function() {
				$("#favBtn").on('click', function(){
				var mapCenter = map.getCenter();
				//Edit form to be displayed with new marker
				var EditForm = '<div class="marker-edit">'+
				'<form action="ajax-save.php" method="POST" name="SaveMarker" id="SaveMarker">'+
				'<label for="pName"><span></span><input type="text" name="pName" class="save-name" placeholder="Title" maxlength="40" /></label>'+
				'<label for="pDesc"><span></span><textarea name="pDesc" class="save-desc" placeholder="Type your description" maxlength="150"></textarea></label>'+
				/*'<label for="pType"><span>Type :</span> <select name="pType" class="save-type"><option value="restaurant">Rastaurant</option><option value="bar">Bar</option>'+
				'<option value="house">House</option></select></label>'+*/
				'</form>'+
				'</div><button name="save-marker" class="save-marker">Save Marker Details</button>';

				//Drop a new Marker with our Edit Form
				create_marker(mapCenter, "", EditForm, true, true, true, 'Images/favIcon.png','green');
				});
			});
		
			$(document).ready(function() {
				$("#betterBtn").on('click', function(){
				var mapCenter = map.getCenter();
				//Edit form to be displayed with new marker
				var EditForm = '<div class="marker-edit">'+
				'<form action="ajax-save.php" method="POST" name="SaveMarker" id="SaveMarker">'+
				'<label for="pName"><span></span><input type="text" name="pName" class="save-name" placeholder="Title" maxlength="40" /></label>'+
				'<label for="pDesc"><span></span><textarea name="pDesc" class="save-desc" placeholder="Type your description" maxlength="150"></textarea></label>'+
				/*'<label for="pType"><span>Type :</span> <select name="pType" class="save-type"><option value="restaurant">Rastaurant</option><option value="bar">Bar</option>'+
				'<option value="house">House</option></select></label>'+*/
				'</form>'+
				'</div><button name="save-marker" class="save-marker">Save Marker Details</button>';

				//Drop a new Marker with our Edit Form
				create_marker(mapCenter, "", EditForm, true, true, true, 'Images/betterIcon.png','blue');
				});
			});

			$(document).ready(function() {
				$("#aboutBtn").on('click', function(){
				var mapCenter = map.getCenter();
				//Edit form to be displayed with new marker
				var EditForm = '<div class="marker-edit">'+
				'<form action="ajax-save.php" method="POST" name="SaveMarker" id="SaveMarker">'+
				'<label for="pName"><span></span><input type="text" name="pName" class="save-name" placeholder="Title" maxlength="40" /></label>'+
				'<label for="pDesc"><span></span><textarea name="pDesc" class="save-desc" placeholder="Type your description" maxlength="150"></textarea></label>'+
				/*'<label for="pType"><span>Type :</span> <select name="pType" class="save-type"><option value="restaurant">Rastaurant</option><option value="bar">Bar</option>'+
				'<option value="house">House</option></select></label>'+*/
				'</form>'+
				'</div><button name="save-marker" class="save-marker">Save Marker Details</button>';

				//Drop a new Marker with our Edit Form
				create_marker(mapCenter, "", EditForm, true, true, true, 'Images/aboutIcon.png','red');
				});
			});
										
	}
	
	//############### Create Marker Function ##############
	function create_marker(MapPos, PlaceName, PlaceDesc, InfoOpenDefault, DragAble, Removable, iconPath,winStyle)
	{	  	  		  
		
		if(winStyle == 'green')
			{
				var style = '<div class="marker-info-win fav-win">';
				var engTitle = 'Your favorite place in Austin';
				var spanTitle = 'Tu lugar favorito en Austin';
			}
		else if(winStyle == 'blue')
			{
				var style = '<div class="marker-info-win better-win">';
				var engTitle = 'I want this to be better';
				var spanTitle = 'Quiero que esto sea mejor';
			}
		else
			{
				var style = '<div class="marker-info-win about-win">';
				var engTitle = 'Tell us about your city';
				var spanTitle = 'Mu&#233;stranos tu ciudad';
			}
		//new marker
		var marker = new google.maps.Marker({
			position: MapPos,
			map: map,
			draggable:DragAble,
			animation: google.maps.Animation.DROP,
			//title:"Hello World!",
			icon: iconPath,

		});
		
		//Content structure of info Window for the Markers
		if(PlaceName == '')
		{
			var contentString = $(style+'<br>'+
			'<div class="marker-heading">' + engTitle+ '<div>----------------</div>' + spanTitle + '</div>' +
			'<div class="marker-inner-win"><span class="info-content">'+
			PlaceName+
			PlaceDesc+ 
			'</span><button name="remove-marker" class="remove-marker" title="Remove Marker">Remove Marker</button></div></div>');

			//Create an infoWindow
			var infowindow = new google.maps.InfoWindow({maxWidth: 300});
			//set the content of infoWindow
			infowindow.setContent(contentString[0]);

			var removeBtn 	= contentString.find('button.remove-marker')[0];
			google.maps.event.addDomListener(removeBtn, "click", function(event) {
			remove_marker(marker);
			});

		} else {

			var contentString = $(style+'<br>'+
			'<div class="marker-heading">' + engTitle+ '<div>----------------</div>' + spanTitle + '</div>' +
			'<div class="marker-inner-win"><span class="info-content">'+
			PlaceName+
			PlaceDesc+ 
			'</span><button name="delete-marker" class="delete-marker" title="Delete Marker">Delete Marker</button></div></div>');

			//Create an infoWindow
			var infowindow = new google.maps.InfoWindow({width: 400});
			//set the content of infoWindow
			infowindow.setContent(contentString[0]);
			var deleteBtn 	= contentString.find('button.delete-marker')[0];

			//add click listner to remove marker button
			google.maps.event.addDomListener(deleteBtn, "click", function(event) {
			delete_marker(marker);
			});
		}
		
		
		var saveBtn	= contentString.find('button.save-marker')[0];

		if(typeof saveBtn !== 'undefined') //continue only when save button is present
		{
			//add click listner to save marker button
			

			google.maps.event.addDomListener(saveBtn, "click", function(event) {
				//var mTitle = MarkerTitle;
				var mapPinURL = iconPath;
				var mReplace = contentString.find('span.info-content'); //html to be replaced after success
				var mName = contentString.find('input.save-name')[0].value; //name input field value
				var mDesc  = contentString.find('textarea.save-desc')[0].value; //description input field value
				//console.log(mTitle);
				//console.log(mName);
				
				
				
				//var mType = contentString.find('select.save-type')[0].value; //type of marker
				
				if(mName =='')
				{
					alert("Please enter Name and Description!");
				}else{
					save_marker(marker, mName, mDesc, mReplace, winStyle, mapPinURL); //call save marker function
				}
			});
		}
		
		//add click listner to save marker button		 
		google.maps.event.addListener(marker, 'click', function() {
				infowindow.open(map,marker); // click on marker opens info window 
	    });
		  
		if(InfoOpenDefault) //whether info window should be open by default
		{
		  infowindow.open(map,marker);
		}
	}
	
	//############### Remove Marker Function ##############
	function remove_marker(Marker)
	{
		
		/* determine whether marker is draggable 
		new markers are draggable and saved markers are fixed */
		if(Marker.getDraggable()) 
		{
			Marker.setMap(null); //just remove new marker
		}
		else
		{
			//Remove saved marker from DB and map using jQuery Ajax
			var mLatLang = Marker.getPosition().toUrlValue(); //get marker position
			var myData = {del : 'true', latlang : mLatLang}; //post variables
			$.ajax({
			  type: "POST",
			  url: "map_process.php",
			  data: myData,
			  success:function(data){
					Marker.setMap(null); 
					//alert(data);
				},
				error:function (xhr, ajaxOptions, thrownError){
					alert(thrownError); //throw any errors
				}
			});
		}

	}

	function delete_marker(Marker)
	{

		var password = prompt("Please enter the password", "");

		if(password == "libro")
		{
			if(Marker.getDraggable()) 
			{
				Marker.setMap(null); //just remove new marker
			}
			else
			{
				//Remove saved marker from DB and map using jQuery Ajax
				var mLatLang = Marker.getPosition().toUrlValue(); //get marker position
				var myData = {del : 'true', latlang : mLatLang}; //post variables
				$.ajax({
				  type: "POST",
				  url: "map_process.php",
				  data: myData,
				  success:function(data){
						Marker.setMap(null); 
						//alert(data);
					},
					error:function (xhr, ajaxOptions, thrownError){
						alert(thrownError); //throw any errors
					}
				});
			}
		} else {

			alert("Incorrect password. Please try again.");


		}


	}
	
	//############### Save Marker Function ##############
	function save_marker(Marker, mName, mDescription, replaceWin, winStyle, mapPinURL)
	{
		//Save new marker using jQuery Ajax
		var mLatLang = Marker.getPosition().toUrlValue(); //get marker position
		var myData = {name : mName, description : mDescription, latlang : mLatLang, winStyle: winStyle, mapPinURL: mapPinURL}; //post variables
		//console.log(winStyle);
		//console.log(replaceWin);		
		$.ajax({
		  type: "POST",
		  url: "map_process.php",
		  data: myData,
		  success:function(data){
				replaceWin.html(data); //replace info window with new html
				Marker.setDraggable(false); //set marker to fixed
				Marker.setIcon(mapPinURL); //replace icon
            },
            error:function (xhr, ajaxOptions, thrownError){
                alert(thrownError); //throw any errors
            }
		});
	}

});
</script>

<style type="text/css">
::-webkit-input-placeholder {
    font-family: sans-serif;
    font-size: 12px;
}
:-moz-placeholder {
    /* FF 4-18 */
    font-family: sans-serif;
    font-size: 12px;
}
::-moz-placeholder {
    /* FF 19+ */
    font-family: sans-serif;
    font-size: 12px;
}
:-ms-input-placeholder {
    /* IE 10+ */
    font-family: sans-serif;
    font-size: 12px;
}
#heading{
	padding-top:20px;
	margin: 0px 0px .25% 0px;
	margin-left: 30px; 
	position: relative; 
	z-index: 10; 
	text-align:left;
	font-size: 58px;
	/*font-size: 2.25vw;*/
	font-weight: bold;
	color: #ffffff;
	font-family: Sans-Serif;
	/*-webkit-text-stroke-width: 2px;
    -webkit-text-stroke-color: black;*/
    width: 330px;
    text-shadow:
   -1.5px -1.5px 0 #000,  
    1.5px -1.5px 0 #000,
    -1.5px 1.5px 0 #000,
     1.5px 1.5px 0 #000;
}

/* width and height of google map */
/*#google_map {width: 90%; height: 1000px;margin-top:auto;margin-left:auto;margin-right:auto;}*/
html, body {padding:0px;margin: 0px 0px 0px 0px;width: 100%; height: 100%; font-family: sans-serif;}
#google_map {width: 100%; height: 100%; position:absolute;z-index: 1}

/* menu buttons */
/*#menu-buttons {display: block; width: 170px;text-decoration: none; list-style-type: none; font: 18px; float: left;}*/
.menu-button{
   /* border-top: 1px solid #969696;*/
   background: #000000;
   background: -webkit-gradient(linear, left top, left bottom, from(#373737), to(#000000));
   background: -webkit-linear-gradient(top, #373737, #000000);
   background: -moz-linear-gradient(top, #373737 #000000);
   background: -ms-linear-gradient(top, #373737, #000000);
   background: -o-linear-gradient(top, #373737, #000000);
   padding: 5px 10px;
   /*margin: 5px 5px 5px 5px;*/
   -webkit-border-radius: 2px;
   -moz-border-radius: 2px;
   border-radius: 2px;
   -webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;
   -moz-box-shadow: rgba(0,0,0,1) 0 1px 0;
   box-shadow: rgba(0,0,0,1) 0 1px 0;
   /*text-shadow: rgba(0,0,0,.4) 0 1px 0;
   /*color: #e3e3e3 !important;*/
   color: #ffffff;
   font-size: 18px;
   /*font-size: .7vw;*/
   text-decoration: none;
   vertical-align: middle;
   height: 14%;
   margin-right: 10px;
   margin-left: 10px;
   margin-bottom: 5%;
   text-align: center;
   padding-top: 30px;
   font-weight: lighter;
   /*float: left;*/
   }
.menu-button:hover {
   /*border-top-color: #4f4f4f;*/
   background: #4f4f4f;
   color: #ccc;
   text-decoration:none;
   }
.menu-button:active {
   /*border-top-color: #4a4a4a;*/
   background: #4a4a4a;
   }

.menu{
	display: inline-block;
	border-width: 8px;
  	border-color: rgb( 255, 255, 255 );
  	border-style: dashed;
  	/*box-shadow: 2px 2px 4px #000000;*/
	/*float:left;*/
	width: 300px;
	height: 655px;
	/*width: 11.75%;*/
	/*height: 49%;*/
	z-index: 10;
	position: relative;
	margin-left: 30px;
	margin-top: 5px;
    
}
#leave-your-on-the-map{
  font-size: 40px;
  margin-top: 4%;
  margin-bottom: 4%;
  /*font-size: 1.65vw;*/
  font-family: sans-serif;
  color: rgb( 255, 255, 255 );
  text-align: center;
  /*position: absolute;*/
  font-weight: bold;
  z-index: 10;
 /* -webkit-text-stroke-width: 2px;
  -webkit-text-stroke-color: black;*/
  text-shadow:
  -1.5px -1.5px 0 #000,  
    1.5px -1.5px 0 #000,
    -1.5px 1.5px 0 #000,
     1.5px 1.5px 0 #000;

}

#mark{
	font-size: 80px;
	/*font-size: 3.25vw;*/
	letter-spacing: 6px;
  font-family: sans-serif;
  color: rgb( 255, 255, 255 );
  text-align: center;
  /*position: absolute;*/
  margin-top: -3%;
  margin-bottom: -6%;
  z-index: 10;
  font-weight: bold;
  /*-webkit-text-stroke-width: 2px;
  -webkit-text-stroke-color: black;*/
  text-shadow:
  -1.5px -1.5px 0 #000,  
    1.5px -1.5px 0 #000,
    -1.5px 1.5px 0 #000,
     1.5px 1.5px 0 #000;

}

.saved-info{
	background: #ffffff;
	font-size: 14px;
	
	width: 93%;
	margin:4px 0px 0px 5px;
	padding-left: 5px;
	border: 1px solid #000;
	border-radius: 3px;
}

.saved-description{

	min-height: 140px;
}

.saved-title{

	min-height: 30px;

}

#rectangle_1 {
  
  border-color: rgb( 255, 255, 255 );
  border-style: dashed;
  border-style: solid;
  border-width: 2px;
  border-color: rgb( 0, 0, 0 );
  position: absolute;
  left: -2px;
  top: -4px;
  width: 324px;
  height: 628px;
  z-index: 5;
  text-shadow:
  -1.5px -1.5px 0 #000,  
    1.5px -1.5px 0 #000,
    -1.5px 1.5px 0 #000,
     1.5px 1.5px 0 #000;
}
.gm-style-iw {min-width: 260px; max-height: 340px;padding: 0px; margin: 0px;}
.gm-style-iw *{overflow: visible !important;}
button:focus {outline:0;}
#favBtn{border: 3px solid #72a03e;}
#betterBtn{border: 3px solid #045b64;}
#aboutBtn{border: 3px solid #6b2049;}

/* Marker Edit form */
.marker-edit label{display:block;margin-bottom: 5px;}
.marker-edit label span {width: 1px;float: left;}
.marker-edit label input, .marker-edit label select{height: 30px;}
.marker-edit label textarea{height: 120px; padding-top: 5px;}
.marker-edit label input, .marker-edit label select, .marker-edit label textarea {width: 93%;margin:4px 0px 0px 5px;padding-left: 5px;border: 1px solid #000;border-radius: 3px;}

/* Marker Info Window */
.marker-heading
{/*color: #585858;margin: 0px;padding: 0px;font: 18px "Trebuchet MS", Arial;border-bottom: 1px dotted #D8D8D8;*/
	 background: #000000;
   background: -webkit-gradient(linear, left top, left bottom, from(#373737), to(#000000));
   background: -webkit-linear-gradient(top, #373737, #000000);
   background: -moz-linear-gradient(top, #373737 #000000);
   background: -ms-linear-gradient(top, #373737, #000000);
   background: -o-linear-gradient(top, #373737, #000000);
   padding: 5px 10px;
   /*margin: 5px 5px 5px 5px;*/
   -webkit-border-radius: 2px;
   -moz-border-radius: 2px;
   border-radius: 2px;
   -webkit-box-shadow: rgba(0,0,0,1) 0 1px 0;
   -moz-box-shadow: rgba(0,0,0,1) 0 1px 0;
   box-shadow: rgba(0,0,0,1) 0 1px 0;
   /*text-shadow: rgba(0,0,0,.4) 0 1px 0;
   /*color: #e3e3e3 !important;*/
   color: #ffffff;
   font-size: 16px;
   text-decoration: none;
   vertical-align: middle;
   min-height: 80px;
   margin-right: 10px;
   margin-left: 8px;
   margin-bottom: 0px;
   margin-top: -8px;
   text-align: center;
   padding-top: 25px;
   font-weight: lighter;
   width: 88%;


}
div.marker-info-win {min-width: 120%; min-height:360px !important;margin: -10px 0px 0px -20px;}
div.fav-win {background: #72a03e;}
div.better-win{background: #045b64;}
div.about-win{background: #6b2049;}
div.marker-info-win p{padding: 0px;}
div.marker-inner-win{padding: 5px; min-width: 300px; min-height: }
button.save-marker{border: none;
	background: #777675;
	color: #000;
	padding: 8px 8px 8px 8px;
	height: 40px;
	width: 180px;
	text-decoration: none;
	font-size:15px;
	margin-left: 6px;
	position: relative;
	margin-top:4px;
	margin-bottom:4px;
	cursor: pointer;

}
button.remove-marker{
	border: none;
	background: #777675;
	color: #000;
	padding: 8px 8px 8px 8px;
	height: 40px;
	width: 142px;
	text-decoration: none; 
	font-size:15px; 
	
	
	margin-left: 7px;
	margin-right: 11px;
	margin-top:4px;
	margin-bottom:4px;
	position: relative;
	cursor: pointer;



}

button.delete-marker{
	border: none;
	background: #777675;
	color: #000;
	padding: 8px 8px 8px 8px;
	height: 40px;
	width: 142px !important;
	text-decoration: none; 
	font-size:15px; 
	
	float: right;
	margin-left: 7px;
	margin-right: 11px;
	margin-top:8px;
	margin-bottom:4px;
	position: relative;
	cursor: pointer;



}
button.save-marker:hover, button.remove-marker:hover{background: #909a91;}
button.save-marker:active, button.remove-marker:active{background: #909a91;}
.home-button{

	z-index: 10;
	margin-left: 20px;
	margin-top: 10px;
	position: relative;
	/*width: 4%;*/
	width: 100px;

}

.home-button img{

	margin-left: 20px;
	width: 100%;

}
.home-button p{
	
	margin-left: 30px;
	margin-top: -10px;
	font-size: 20px;
	font: #fff;
	text-shadow:
   -1.5px -1.5px 0 #000,  
    1.5px -1.5px 0 #000,
    -1.5px 1.5px 0 #000,
     1.5px 1.5px 0 #000;

}
a:link{
	text-decoration: none;
	color: #fff;
}
a:visited{
	color: #fff;
}

</style>
</head>
<body> 
<div id="google_map"></div>        
<div id="heading">The Stacks</div>
<div class="menu">
<div id='leave-your-on-the-map'>LEAVE YOUR</div>
<div id='mark'>MARK</div>
<div id='leave-your-on-the-map'>ON THE MAP</div>
<div class="menu-button" id = "favBtn">Your favorite place in Austin<div>----------------</div><div>Tu lugar favorito en Austin</div></div>
<div class="menu-button" id = "betterBtn">I want this to be better<div>----------------</div><div>Quiero que esto sea mejor</div></div>
<div class="menu-button" id = "aboutBtn">Tell us About Your City<div>----------------</div><div>Mu&#233;stranos tu ciudad</div></div>
</div>
<div class='home-button'><a href="http://utw10077.utweb.utexas.edu/"><img src="Images/theStacksMapHomeBtn.png"><p>Return <br> Home</p></a></div>

</body>
</html>